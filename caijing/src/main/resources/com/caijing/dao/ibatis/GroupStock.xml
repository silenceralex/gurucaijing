<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="GroupStockDao">

	<typeAlias alias="GroupStock" type="com.caijing.domain.GroupStock" />
	<typeAlias alias="RecommendStock" type="com.caijing.domain.RecommendStock" />

	<select id="select" resultClass="GroupStock"
		parameterClass="java.util.Map">
		select * from groupstock where groupid=#groupid#
	</select>


	<select id="getCurrentStockByGroupid" resultClass="GroupStock"
		parameterClass="java.lang.String">
		select * from groupstock where groupid=#value# and status=1
	</select>

	<select id="getCurrentStockByGroupidAndStockcode"
		resultClass="GroupStock" parameterClass="java.util.Map">
		select * from groupstock where groupid=#groupid# and
		stockcode=#stockcode# and status=1
	</select>

	<insert id="insert">
		insert into groupstock
		(groupid,groupname,stockcode,intime,inreportid,objectprice,inprice)
		values
		(#groupid#,#groupname#,#stockcode#,#intime#,#inreportid#,#objectprice#,#inprice#)
	</insert>
	
	<update id="updateStockGain" parameterClass="GroupStock">
		update groupstock
		<dynamic prepend="set">
			<isNotEmpty prepend="," property="currentprice">
				currentprice = #currentprice#
			</isNotEmpty>
			<isNotEmpty prepend="," property="gain">
				gain = #gain#
			</isNotEmpty>
			<isNotEmpty prepend="," property="ltime">
				ltime = #ltime#
			</isNotEmpty>
		</dynamic>
		where groupid=#groupid# and stockcode=#stockcode# and status =1
	</update>
	
	

	<update id="update" parameterClass="GroupStock">
		update groupstock
		<dynamic prepend="set">
			<isNotEmpty prepend="," property="outtime">
				outtime = #outtime#
			</isNotEmpty>
			<isNotEmpty prepend="," property="outreportid">
				outreportid = #outreportid#
			</isNotEmpty>
		</dynamic>
		,status = 0 where groupid=#groupid# and stockcode=#stockcode# and status =1
	</update>

	<delete id="delete" parameterClass="GroupStock">

	</delete>


	<select id="getEarliestIntimeByAid" resultClass="java.util.Date"
		parameterClass="java.lang.String">
		select intime from groupstock where groupid=#aid# order by
		intime limit 1
	</select>

	<select id="getAllGroupStock" resultClass="GroupStock">
		select * from groupstock where status=1
	</select>

	
	<select id="getNameAndCodeByAid" resultClass="GroupStock" parameterClass="java.lang.String">
		select s.stockname as stockname,gs.* from groupstock gs,stock s where gs.groupid=#aid# and gs.stockcode = s.stockcode and gs.status=1
	</select>
	
	<select id="getGroupStockListAsc" resultClass="GroupStock">
		select gs.*,s.stockname as stockname from groupstock gs,stock s where gs.stockcode = s.stockcode order by gain limit #length#
	</select>
	
	<select id="getGroupStockListDesc" resultClass="GroupStock">
		select gs.*,s.stockname as stockname from groupstock gs,stock s where gs.stockcode = s.stockcode order by gain desc limit #length#
	</select>
	
	<select id="getRecommendReportids" resultClass="java.lang.String"  parameterClass="java.util.Map">
		select inreportid from groupstock order by intime desc limit #start#,#length#
	</select>
	
	<select id="getRecommendReportCount" resultClass="java.lang.Integer">
		select count(1) from groupstock
	</select>
</sqlMap>